<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link
      rel="stylesheet"
      href="https://cdn.datatables.net/1.11.3/css/jquery.dataTables.min.css"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css"
      rel="stylesheet"
    />
    <style></style>
  </head>
  <body>
    <div style="margin-bottom: 5px">
      <button id="add">Add</button>
      <button id="fetch">Fetch</button>
      <button id="get">Get</button>
      <button id="reset">Reset</button>
    </div>

    <table id="example" class="display" style="width: 100%">
      <!-- <thead>
        <tr>
          <th>Name</th>
          <th>Position</th>
          <th>Office</th>
          <th>Salary</th>
        </tr>
      </thead>
      <tfoot>
        <tr>
          <th>Name</th>
          <th>Position</th>
          <th>Office</th>
          <th>Salary</th>
        </tr>
      </tfoot> -->
      <tfoot>
        <tr>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
        </tr>
      </tfoot>
    </table>

    <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
    <script src="https://cdn.datatables.net/1.11.3/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script>
      var intVal = function (i) {
        return typeof i === "string"
          ? i.replace(/[\$,]/g, "") * 1
          : typeof i === "number"
          ? i
          : 0;
      };
      var table;
      $(document).ready(function () {
        table = $("#example").DataTable({
          // ajax: "./api.json",
          lengthMenu: [
            [5, 10, 15, -1],
            [5, 10, 15, "All"],
          ],
          columns: [
            {
              title: "SNo",
              data: "",
              width: "30px",
              // orderable: false,
              render: function (data, type, row, n) {
                return n.row;
              },
            },
            {
              title: "Name",
              data: "name",
              render: function (data, type, row) {
                return `<input type="text" value="${
                  data !== null ? data : ""
                }" placeholder="Name" id="S_Name" />`;
              },
            },
            {
              title: "Position",
              data: "position",
              render: function (data, type, row, o) {
                return `<input type="text" value="${
                  data !== null ? data : ""
                }" placeholder="Position" id="S_Position" />`;
              },
            },
            {
              title: "Office",
              data: "office",
              render: function (data, type, row) {
                return `<input type="text" value="${
                  data !== null ? data : ""
                }" placeholder="Office" id="S_Office" />`;
              },
            },
            {
              title: "Salary",
              data: "salary",
              render: function (data, type, row) {
                return `<input type="text" value="${
                  data !== null ? data : ""
                }" placeholder="Salary" id="S_Salary" />`;
              },
            },
            {
              title: "=",
              data: "",
              render: function (data, type, row) {
                return `<input type="button" value="Remove" id="removeRow" />`;
              },
            },
          ],
          // createdRow: function (row, data, index, node) {
          //   // console.log(row, data, index, node);
          // },
          footerCallback: function (row, data, start, end, display) {
            var api = this.api();
            // Remove the formatting to get integer data for summation
            var total = api
              // .column(4, { page: "current" })
              .column(4)
              .data()
              .reduce(function (a, b) {
                return intVal(a) + intVal(b);
              }, 0);
            $(api.column(4).footer()).html(`$ ${total}`);
          },
        });

        //input fields
        $(document).on(
          "input",
          "#S_Name, #S_Position, #S_Office, #S_Salary",
          function () {
            var c = table.row($(this).closest("tr")).data();
            // console.log(table.column(4).footer());
            switch ($(this).attr("id")) {
              case "S_Name":
                c.name = $(this).val();
                break;
              case "S_Position":
                c.position = $(this).val();
                break;
              case "S_Office":
                c.office = $(this).val();
                break;
              case "S_Salary":
                c.salary = $(this).val();
                var total = table
                  .column(4)
                  .data()
                  .reduce(function (a, b) {
                    return intVal(a) + intVal(b);
                  }, 0);

                $(table.column(4).footer()).html(`$ ${total}`);
                break;
              default:
                return "";
            }
          }
        );

        //Add
        $("#add").click(function () {
          console.log("Adding..");
          table.row
            .add({
              name: null,
              position: null,
              office: null,
              salary: null,
            })
            .draw(false);
          table.page("last").draw("page");
        });

        //Fetch
        $("#fetch").click(function () {
          console.log("fetching...");
          table.ajax.url("/api.json").load();
        });

        //Get
        $("#get").click(function () {
          console.log("getting..");
          console.log(table.rows().data());
        });

        //Reset
        $("#reset").click(function () {
          console.log("Reset..");
          table.clear().draw();
        });

        $(document).on("click", "#removeRow", function () {
          console.log("remove row..");
          table.row($(this).parents("tr")).remove().draw();
        });

        // table.on("search.dt", function () {
        //   console.log("Searching...");
        //   // table
        //   //   .column(0)
        //   //   .nodes()
        //   //   .each(function (cell, i) {
        //   //     cell.innerHTML = i + 1;
        //   //     // console.log(cell, i);
        //   //   });
        // });
      });
    </script>
  </body>
</html>
